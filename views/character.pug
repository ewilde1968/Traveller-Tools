extends layout

block content
  div#characterHeader
    table
      tr
        th Name
        td character.name
      tr
        th Title
        td character.title
      tr
        th Age
        td character.age
  div#characterStats
    table
      tr
        th Stat
        th Value
        th Modifier
        each stat in character.stats
          if stat
            tr
              th= stat.name
              td= stat.value
              td= stat.modifier
  div#characterSkills
    if character.skills && character.skills.length > 0
      table
        tr
          th Skill
          th Stat
          th Rank
        each skill in character.skills
          tr
            th= skill.name
            td= skill.stat ? skill.stat.name : ''
            td= skill.rank
      div#enrollment
        form( action=('/character/'+character.id) method='post')
          if service
            if term.rank == undefined
              p= 'Recently enlisted in the ' + baseService.name + ' service.'
            else
              p= 'Currently serving as a ' + titles[term.rank-(term.commissioned?1:0)].name + ' in the ' + baseService.name + ' service.'
          if service && !term.completed
            if !term.skills || term.skills.length == 0 || term.promoted
              p Please choose a skill type.
              select#tskillSelect(name='termskill')
                option(value='Personal Development') Personal Development
                if baseService.higherEd && character.stats.find((e) => e.name.match('Education')).value >= 8
                  option(value='Higher Education') Higher Education
                if baseService.officer && term.commissioned
                  option(value='Officer') Officer
                option(value='Service Skills') Service Skills
                if service.skills
                  option(value= service.name )= service.name
              button(disabled) Submit
            else if !term.commissioned && baseService.commission
              p Try to become a commissioned officer?
              button(name='commission' value= 'true') Yes
              button(name='commission' value= false) No
          else
            p Please select a service in which to enlist.
            select#enrollmentSelect(name='enroll')
              each so in serviceOptions
                if so.assignment && so.assignment.length > 0
                  optgroup(
                    label= so.name
                    title= so.description
                  )
                    each a in so.assignment
                      option(
                        value= so.name + ' (' + a.name + ')'
                        selected= term && service.name.match(a.name)
                        class= (term && service.name.match(a.name)) ? 'curServ' : 'difServ'
                        title= a.description
                      )= a.name
                else
                  option(
                    value= so.name
                    selected= term && service.name.match(so.name)
                    class= (term && service.name.match(so.name)) ? 'curServ' : 'difServ'
                    title= so.description
                  )= so.name
              option(value= 'Muster Out') Muster Out
            button#enrollButton()= inService ? 'Re-Enlist' : 'Submit'
    else
      p Select 3 Adolescent Skills
      form( action=("/character/"+character.id) method="post")
        select#adskillSelect(name='adskill' multiple='multiple' size=adolescentSkills.length)
          each skill in adolescentSkills
            option(value= skill.name)= skill.name
        button(disabled) Submit

  script.
    $(document).ready( function() {
        $('#adskillSelect').change( function() {
            if( 3 == $('#adskillSelect option:selected').length)
                $('button').removeAttr('disabled');
            else
                $('button').attr('disabled','disabled');
        });

        $('#tskillSelect').change( function() {
            if( $('#tskillSelect option:selected').length)
                $('button').removeAttr('disabled');
            else
                $('button').attr('disabled','disabled');
        });

        $('#enrollmentSelect').change( function() {
            var s = $('#enrollmentSelect option:selected');
            if( s && s.length) {
                $('#enrollButton').removeAttr('disabled');
                $('#enrollButton').text(s.hasClass('currentService') ? 'Re-Enlist' : 'Submit');
            } else {
                $('#enrollButton').attr('disabled','disabled');
                $('#enrollButton').text('Submit');
            }
        });
        
        $('button').attr('form',$('form:first').attr('id'));
    });
